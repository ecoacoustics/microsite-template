+++
title = 'Can you hear a Plains Wanderer?'
draft = false
+++

<script
    type="module"
    src="https://cdn.jsdelivr.net/npm/@ecoacoustics/web-components/dist/components.js"
></script>

<div>
    <sl-input
        id="auth-token-input"
        type="password"
        label="Authentication Token"
        password-toggle
    ></sl-input>

    <p>
        You can find your authentication token by navigating to
        <a href="https://staging.ecosounds.org/my_account" target="_blank">
            staging.ecosounds.org/my_account
        </a>
        and clicking on the "Copy" icon on the bottom left of the page.
    </p>
</div>

<oe-verification-grid id="verification-grid" grid-size="1">
    <oe-verification verified="true" shortcut="y">Yes</oe-verification>
    <oe-verification verified="false" shortcut="n">No</oe-verification>
</oe-verification-grid>
<oe-data-source for="verification-grid"></oe-data-source>

<script type="module">
    import { BawApi } from "/js/baw-api.js";

    let bawApi = new BawApi("https://api.staging.ecosounds.org");
    const gridElements = document.querySelectorAll("oe-verification-grid");

    async function bootstrapVerificationGrid(target) {
        const callback = await bawApi.eventCallback("Abbott's Babbler");
        target.getPage = callback;

        target.addEventListener("decision-made", (event) => {
            const decisions = event.detail;
            for (const decision of decisions) {
                bawApi.upsertVerification(decision);
            }
        });
    }

    async function updateUrlTransformers() {
        for (const element of gridElements) {
            element.urlTransformer = bawApi.createUrlTransformer();

            // restart the verification task to explicitly reset the
            // verification task back to the start and regenerate all of the
            // spectrograms.
            //
            // TODO: Remove this hack once upstream bugs are fixed
            // see: https://github.com/ecoacoustics/web-components/issues/333
            element.subjects = [];
        }
    }

    async function setup() {
        for (const element of gridElements) {
            bootstrapVerificationGrid(element);
        }
        updateUrlTransformers();

        const authElement = document.getElementById("auth-token-input");
        authElement.addEventListener("sl-change", (event) => {
            const value = event.target.value;
            bawApi.authToken = value;
            updateUrlTransformers();
        });
    }

    setup();
</script>

<style>
    #auth-token-input {
        margin-bottom: 1rem;
    }
</style>
