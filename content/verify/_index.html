+++
title = 'Can you hear a Plains Wanderer?'
draft = false
+++

<script
    type="module"
    src="https://cdn.jsdelivr.net/npm/@ecoacoustics/web-components/dist/components.js"
></script>

<sl-input
    id="auth-token-input"
    type="password"
    label="Authentication Token"
    password-toggle
></sl-input>

<oe-verification-grid id="verification-grid" grid-size="1">
    <oe-verification verified="true" shortcut="y">Yes</oe-verification>
    <oe-verification verified="false" shortcut="n">No</oe-verification>
</oe-verification-grid>
<oe-data-source for="verification-grid"></oe-data-source>

<script type="module">
    import { BawApi } from "/js/baw-api.js";
    let bawApi = new BawApi("https://api.staging.ecosounds.org");

    async function handleDecision(model) {
        await this.api.upsertVerification();
    }

    async function bootstrapVerificationGrid(target) {
        const callback = await bawApi.eventCallback("Willie Wagtail");
        target.getPage = callback;
        updateUrlTransformer(target);

        target.addEventListener("decision-made", (decision) => {
            handleDecision(decision);
        });
    }

    async function updateUrlTransformers() {
        const targets = document.querySelectorAll("oe-verification-grid");
        for (const element of targets) {
            element.urlTransformer = bawApi.createUrlTransformer();
            element.subjects = [];
        }
    }

    async function setup() {
        const targets = document.querySelectorAll("oe-verification-grid");
        for (const element of targets) {
            bootstrapVerificationGrid(element);
        }

        const authElement = document.getElementById("auth-token-input");
        authElement.addEventListener("sl-change", (event) => {
            const value = event.target.value;
            bawApi.setAuthToken = value;
            updateUrlTransformers();
        });
    }

    setup();
</script>
